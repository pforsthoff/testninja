// Scripted Pipeline with stages
node {
    stage('Source') { // Get code
        git( 
            url: 'https://github.com/pforsthoff/testninja.git/', 
            branch: 'master'
            )
    }
    stage('Build (dotnet build)') {
        sh 'echo "Building dotnet app"'
        sh 'dotnet build'
        }
    stage('Build (dotnet test)') {
        sh 'echo "Testing dotnet app"'
        sh 'dotnet test TestNinja.sln /p:CollectCoverage=true /p:CoverletOutputFormat=opencover /p:CoverletOutput="coverage.opencover.xml"'
        }
    stage('Initialize'){
            def dockerHome = tool 'myDocker'
            env.PATH = "${dockerHome}/bin:${env.PATH}"
        }
    stage('Build Docker image') {
        
                dockerImage = docker.build('pforsthoff/testninja:$BUILD_NUMBER')
            
    }
    stage ('Docker push') {
        docker.withRegistry('https://hub.docker.com/repository/docker/pforsthoff/testninja', 'dockerhub') {
        docker.image('pforsthoff/testninja').push('latest')
    }
  }
}